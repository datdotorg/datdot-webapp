const message_maker = require('message-maker')
const make_element = require('make-element')
const style_sheet = require('support-style-sheet')
// widgets
const i_nav = require('components/datdot-ui-navigation/src')
const i_actions = require('components/datdot-ui-actions/src')

module.exports = i_footer
function i_footer ({page = '*', flow = 'ui-footer', name = '.', body = {}, to = '#'}, protocol) {
    const {nav = {}, status = {}} = body

    const recipients = []
    const make = message_maker(`${name} / ${flow} / ${page}`)
    
    function widget () {
        const send = protocol(get)
        const sub_actions = make_element({name: 'div', classlist: 'sub-actions'})
        const el = make_element({name: 'footer', classlist: 'footer'})
        const shadow = el.attachShadow({mode: 'closed'})
        const actions = i_actions( {name: `${name}-actions`, status}, footer_protocol(`${name}-actions`) )
        const navigtaion = i_nav( {name: `${name}-nav`, body: nav, to}, footer_protocol(`${name}-nav`) )
        style_sheet(el, style)
        shadow.append(actions, navigtaion)

        return el

        function handle_actions_event (from, data) {
            console.log(from, data)
        }

        function footer_protocol (name) {
            return send => {
                recipients[name] = send
                return get
            }
        }
        function get (msg) {
            const {head, type, refs, meta, data} = msg
            const from = head[0].split(' / ')[0]
            send(make(msg))
            // console.log(msg)
        }
    }
    
    const style = ``

    return widget()
}